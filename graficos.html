<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gr치ficos Hist칩ricos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        background: #121212;
        color: #e0e0e0;
        font-family: Arial;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    .card {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    .controls {
        text-align: center;
        margin-bottom: 20px;
    }
    input {
        padding: 5px;
        margin: 5px;
        border-radius: 5px;
        border: none;
    }
    button {
        padding: 8px 20px;
        background: #90caf9;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>游늵 Gr치ficos Hist칩ricos</h1>

<div class="controls">
    <input type="datetime-local" id="inicio">
    <input type="datetime-local" id="fin">
    <button onclick="cargarDatos()">Buscar</button>
</div>

<div class="card">
    <h2>Temperatura, Humedad y Viento</h2>
    <canvas id="chartTHV"></canvas>
</div>

<div class="card">
    <h2>Luz</h2>
    <canvas id="chartLuz"></canvas>
</div>

<div class="card">
    <h2>Presi칩n Atmosf칠rica</h2>
    <canvas id="chartPresion"></canvas>
</div>

<div class="card">
    <h2>Voltaje de Bater칤a</h2>
    <canvas id="chartVoltaje"></canvas>
</div>

<script>
let chartTHV, chartLuz, chartPresion, chartVoltaje;

async function cargarDatos() {
    let inicio = document.getElementById("inicio").value;
    let fin = document.getElementById("fin").value;

    let url = "/history";
    if (inicio && fin) url += `?inicio=${inicio}&fin=${fin}`;

    const res = await fetch(url);
    const data = await res.json();

    let fechas = data.map(r => r.fechaHora);

    // Datos
    let temp = data.map(r => r.temperatura);
    let hum = data.map(r => r.humedad);
    let viento = data.map(r => r.velocViento);
    let luz = data.map(r => r.luz);
    let pres = data.map(r => r.presion);
    let volt = data.map(r => r.bateriaVolt);

    // Destruir gr치ficos previos
    if (chartTHV) chartTHV.destroy();
    if (chartLuz) chartLuz.destroy();
    if (chartPresion) chartPresion.destroy();
    if (chartVoltaje) chartVoltaje.destroy();

    // Temperatura + Humedad + Viento
    chartTHV = new Chart(document.getElementById("chartTHV"), {
        type: "line",
        data: {
            labels: fechas,
            datasets: [
                { label: "Temp (춿C)", data: temp, borderColor: "#ff7043" },
                { label: "Humedad (%)", data: hum, borderColor: "#29b6f6" },
                { label: "Viento (m/s)", data: viento, borderColor: "#ab47bc" }
            ]
        },
        options: { responsive: true }
    });

    // Luz
    chartLuz = new Chart(document.getElementById("chartLuz"), {
        type: "line",
        data: {
            labels: fechas,
            datasets: [
                { label: "Luz", data: luz, borderColor: "#ffee58" }
            ]
        },
        options: { responsive: true }
    });

    // Presi칩n
    chartPresion = new Chart(document.getElementById("chartPresion"), {
        type: "line",
        data: {
            labels: fechas,
            datasets: [
                { label: "Presi칩n (hPa)", data: pres, borderColor: "#66bb6a" }
            ]
        },
        options: { responsive: true }
    });

    // Voltaje
    chartVoltaje = new Chart(document.getElementById("chartVoltaje"), {
        type: "line",
        data: {
            labels: fechas,
            datasets: [
                { label: "Voltaje (V)", data: volt, borderColor: "#90caf9" }
            ]
        },
        options: { responsive: true }
    });
}

cargarDatos();
</script>

</body>
</html>